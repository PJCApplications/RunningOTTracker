<!DOCTYPE html>
<html>
<head>

    <title>Running OT Tracker</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <link rel="stylesheet" href="CSS/jquery.mobile-1.4.2.css" />

    <script type="text/javascript" charset="utf-8" src="js/cordova.js"></script>

    <script type="text/javascript" charset="utf-8" src="js/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/jquery.mobile-1.4.2.js"></script>
</head>

<body>

<div data-role=page id=home>
    <div data-role=header>
        <h1>Home</h1>
    </div>

    <div data-role=content>
        <a href=# data-role=button id=create> Create overtime table </a>
        <a href=# data-role=button id=remove> Delete overtime table </a>
        <span> datetimelog </span>
        <input type=text id=datetimelog>
        <span> cad </span>
        <input type=text id=cad>
        <span> vehicle </span>
        <input type=text id=vehicle>
        <span> loc </span>
        <input type=text id=loc>
        <span> type </span>
        <input type=text id=type>
        <span> notes </span>
        <input type=text id=notes>
        <span> email </span>
        <input type=text id=email>
        <a href=# data-role=button id=insert> Insert the Overtime </a>
        <a href=# data-role=button id=list> List Overtime </a>
    </div>
</div>

<div data-role=page id=win2 data-add-back-btn=true>
    <div data-role=header>
        <h1>List of customers</h1>
    </div>

    <div data-role=content>
    </div>
</div>

</body>
</html>

<script>

    var db = openDatabase ("Test", "1.0", "Test", 65535);

    $("#create").bind ("click", function (event)
    {
        db.transaction (function (transaction)
        {
            var sql = "CREATE TABLE overtime " +
                    " (id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, " +
                    "datetimelog DATETIME NOT NULL, " +
                    "cad VARCHAR(5), " +
                    "vehicle VARCHAR(10), " +
                    "loc VARCHAR(100), " +
                    "type VARCHAR(6) NOT NULL, " +
                    "notes VARCHAR(250), " +
                    "email VARCHAR(100)";
            transaction.executeSql (sql, undefined, function ()
            {
                alert ("Table created");
            }, error);
        });
    });

    $("#remove").bind ("click", function (event)
    {
        if (!confirm ("Delete table?", "")) return;;
        db.transaction (function (transaction)
        {
            var sql = "DROP TABLE overtime";
            transaction.executeSql (sql, undefined, ok, error);
        });
    });

    $("#insert").bind ("click", function (event)
    {
        var cad = $("#cad").val ();
        var vehicle = $("#vehicle").val ();

        db.transaction (function (transaction)
        {
            var sql = "INSERT INTO overtime (datetimelog, cad, vehicle, loc, type, notes, email) VALUES (?, ?, ?, ?, ?, ?, ?)";
            transaction.executeSql (sql, [datetimelog, cad, vehicle, loc, type, notes, email], function ()
            {
                alert ("Log inserted");
            }, error);
        });
    });

    $("#list").bind ("click", function (event)
    {
        db.transaction (function (transaction)
        {
            var sql = "SELECT * FROM overtime";
            transaction.executeSql (sql, undefined,
                    function (transaction, result)
                    {
                        var html = "<ul>";
                        if (result.rows.length)
                        {
                            for (var i = 0; i < result.rows.length; i++)
                            {
                                var row = result.rows.item (i);
                                var id = row.id;
                                var datetimelog = row.datetimelog;
                                var cad = row.cad;
                                var vehicle = row.vehicle;
                                var loc = row.loc;
                                var type = row.type;
                                var notes = row.notes;
                                var email = row.email;
                                html += "<li>" +
                                        id + "&nbsp;" +
                                        datetimelog + "&nbsp;" +
                                        cad + "&nbsp;" +
                                        vehicle +  "&nbsp;" +
                                        loc + "&nbsp;" +
                                        type + "&nbsp;" +
                                        notes + "&nbsp;" +
                                        email + "&nbsp;" +
                                        "</li>";
                            }
                        }
                        else
                        {
                            html += "<li> No Logs </li>";
                        }

                        html += "</ul>";

                        $("#win2").unbind ().bind ("pagebeforeshow", function ()
                        {
                            var $content = $("#win2 div:jqmData(role=content)");
                            $content.html (html);
                            var $ul = $content.find ("ul");
                            $ul.listview ();
                        });

                        $.mobile.changePage ($("#win2"));

                    }, error);
        });
    });

    function ok ()
    {
    }

    function error (transaction, err)
    {
        alert ("DB error : " + err.message);
        return false;
    }

</script>
